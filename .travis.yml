language: go
go:
- 1.11
before_script:
- sudo apt-get install -qq sshpass
script: 
after_success:
- sshpass -p $SSH_PASS ssh -o StrictHostKeyChecking=no $SSH_USER@$SSH_HOST rm ~/server/game
- sshpass -p $SSH_PASS scp -rp -o stricthostkeychecking=no * $SSH_USER@$SSH_HOST:~/server/game
- sshpass -p $SSH_PASS ssh -o StrictHostKeyChecking=no $SSH_USER@$SSH_HOST docker
  build -t game-server ~/server/game
- sshpass -p $SSH_PASS ssh -o StrictHostKeyChecking=no $SSH_USER@$SSH_HOST docker
  stop game
- sshpass -p $SSH_PASS ssh -o StrictHostKeyChecking=no $SSH_USER@$SSH_HOST docker
  run -e "DB_HOST=postgres" -e "DB_USER=$DB_USER" -e "DB_PASS=$DB_PASS" -e "DB_DB=$DB_DB"
  -e "JWT=$JWT" -e "AVATARS_PATH=/go/src/github.com/go-park-mail-ru/2018_2_LSP_GAME/avatars/"
  -d --link postgres:postgres --publish 4040:8080 -v /var/www/html/avatars:/go/src/github.com/go-park-mail-ru/2018_2_LSP_GAME/avatars/
  --name game --rm game-server
env:
  global:
  - secure: Ais1/KCnoVC2zQotQQWDWssHYgLoQDgM4h95Xd2PHKzaEAMJbBpxvPAMxHPlyRQaT2vmrooDVRTbdY1K6icV1nm++Xl5IXbQ6H1zVf1Z1hxiovAjxBpaW6I8/qLKbeZ4hOnoPMGpxe1HZmTACkwjfmyVja7gBgk5CijvwtkyvvU7kXR94bT6i7juu2sBxNnbn755e9BtAqGPuoKDM+xWgThoMx6Y1q919MwwIK3I0tyl6OSmhSPXZPg3hLCOrwjgiKxnSOQTuHsn/he++cekL1I9jM0qsL3PbOzEHasQfQWqEBK1jprA3bXjqU4+p6X2CZVSQ5dECAvd38qu/kdG41WjJsuTSY3BKxEXzYLdcSOVtwqMuAg4oL7ZRHugO3x0HeuB471OlJNcuRvxrv7FOFE7a5hc+p0+VUZfZXG82W//igdWbomrz9MIkeAG8Mj3u04G8xa8Wp8Wmvd+8C8fJyVqYNsEdxg9X07cBS8bMajakRWeHKRjlcHGP/YGg+cKCdHYEKiF2F2oAQn21oIuCepPsuAbIdQmowN+TAKaKHjuW0OFQE++w6nl6BLVWLTgvRpnCiW7/6RCzHhVFziI16k9NQlwa99Q03yicnb7vnq9ZCFYwBqZAqcC5TvZ8YU86ACFNLZdMNv2pPdhOz3OuUEWqsTa/G2Kd/9XVR1XK+8=
  - secure: kShiT1+oRH3XnGw1tjtvsOq6+xdufOxPKD7tguJWz1U/xr+H1aALNAA1kZhbPyTlUHkdIFSE8LNB8Ua2imoPn29xR9ahnwrMC/kipJxtkJhGeLw1ORDoomaap3B33LL4L3wu/00kMLGJxrAYD4JsIvyZY5ZiZwY/hApSTZcYyYYhyBP590cMzLu94Y7kSmGT5vHpY/uGtgxVxZ7nqA4/XyJHLuw2CWY6+2O3sxpy0d3oVtAEx4yj0Qqon7PiR7i0IHehzAmSkW7ayXDsxxFT2pOPMtzROqrmWscUunzJdQmLvbOAdREpKl9ho2IvBFG2aKKWDWl9ejS8Rr9Ft0pQEkRfXLalPsyKWnFBLtAcx8u+GB0wWSPnEJNj1iPwqyeqReWctNm6VnCTtdzY7/UQr+LSVjtwWw4nSrDCT0S2lKkPXz5yCa5oODqFs5sSFoWW8VHLc9eotyvWAW4yVgTegiyw+hac5er2GeK90TSY4d8UcRuJhEgsPsD/0iPoucwtqSW99zGyDRfD44a7oryWF7dUderuntUNLm2XKD7FnEof016+z/lvnOhLwEtgrfl3dR90RlzR9wIf78SfPpYgiy0j86vJPKWrWriTd0woljgnPcxZexEyhigtvE1a9b0FsiORaSgHrxyN29NWZPL2eyWNA3MCeLPAXgThgqNhqY8=
  - secure: tPXq37xJrssBEfq2C++RdjFOGvZg9Qf5uOlmjacnwQB8OfpSFQHnP07VtmtjeHHiw/15sQYwTK3vK+pvvLMpy1NdgOMmj6UboTK6Wtd16TJGHq+C6i4mci8WDtn3K4rALg6Krmam9kwh/PjO5rZfk+YxOaWRwYcjL0RbPoxrFK+QR87yYUlqobrEjQD8IusznNcPXrohlvzvcFmtHH5B+TSFz/tZSAdhvMArw1Ym+LAdfJ3jFttrpPfFTKNmkhqsTD0RYDdAJP1k7rFEZi4taQi2fLj6La33SKL70UxUooselLCPcxeFC9jkP0q0E67EFiY1ZXOZ/WTFDveFTGmfRLFNjKI6PztepHYONPCrDRnQYD5Ex/Nn3MSs/LQMC3ec/pigeAN1PJxQktF8yS1y786+t74zKQ0BBeJeZ8dvihI8n2TE53Sh3kecr0DAgtKJUs8KajpNzcBQTjlY2QWljAHEnyGyROypV4QZE13b0VFzOwQec3t4UVtGfBid2akhf3h4xpoOTeTe0qLGCx9j/NqW5JdB7WdgUzFovglzDa7uS+Ene6C8cCbgnixwnpWiPBcDPgUKh7BclLmasrm6Nk7OyJ97sZADCGxrUMi0oSLv9LcVRS8M10sNuZRQ/alI6ANbEOhb74tcLhH0zz+4/qk8X3vbTXvqV/a5w1fwE4Y=
  - secure: o/rZ1TvdOgpxNeQSQlzbQPoyj7QE/XJJhVNHYCXnb+DoPfvQ0bgg+MfxYorLqWpHFKMrKjj+58wQ7P1zpsijpqAIWAM2H3Zz+fafyoq1mSjxr0xiYwcFG4E2LkRa3exGddALtFJO4w0fB3u3xR/ws/016kLwZ28FgYA8d1X1G1jp+wyhLBxqpcqH4RvReMy0dFC7qM0s7TRFRkdHbgDCiMDHZO6flgYt1OTXrUcx7i+kvVBqeS52K5dkRBij32wK4BK84Y3hMp+11YTtbb5PSn7WWO7+FPnPtP2cPgu6jXSyCBD6w4utEKDASFRP5xdmldcxMrksj7lLwDu0gTmGdPTT4auSQMGdVjvYUT9c7AXSKSJIHUTugjht2Kj5AhnKbGjc3Y83rdLCGPXv3NDHkjfG82g9NaF6W3Rg/m7xhHGZfpvjwgE08UAwJv090HtL+keYTAKEbvL2nN+J1Sr1Mk4/nJTXfLtfP1Xg3leMleDdpZ7OZOlAGo8NSGqrj9ifWX1+u3TGvMlTMDcA/nU73n5a7tbezzIHKsloT+HHdQWU4gSPK+yEb7xtYcREkyi5qir4voDAO09718mLuCn5YlbMVOpag7ZKohYjYWpxWsLb1uyTT+NUr02F71+MscNa7OJYvSc+399Rg8dGaEUqyySyd9EMwjHieJZGw9QO3SA=
  - secure: yDVqUqtltHZS2dkary49kezDLjuqlhfDrW4dNv75K1r4XcuH5Y+i7ss95twLtbKMxOHUNh0BbFLWHYVAtPOXT2d4QILMpdwZZN/pRN641V8TrDw8f7BrbX/Mu7s937gG+0zzLmz7GSpXyWtQzxuWJiJjm43N8gJARiuUthRForavSXxvKaLm6I7oHunK+TJf3b3DXQ5LPXduuNnM2Jn+0SRnPOOdMSMbQvBGTtnyWXjOtaIHbw2NdRWXk3n68Vftzz10JROYrxolg95hlAFEfe3vfBA7fLimWNLD+hvXpNsaGJPkT104TgqNiyQ28bJjORWyaTRhJNurwMX84r8fc+pNzgg7/zq723uJWgLe5XewwbPHoUirx85sR64aC8Ti7cWwmGeKKMI15CJwxmBr2fDvIG8i/vs8RFtWqux2HohQp6/GuqnaYNiJVK+1nLHmUi1xS2EU5o0PwPgyDSiFBj9yjVima00MuKUoIcimooTBgFBGU4z0qbvPB/Xtym374q1J1kE4jwp7PMReZRQOD2YddEoLtlvezmAvqGQmqVNznX/xbXb9xiz2Kx74PnLszYg/iSshKcrlxggG5EjcfXONryT4f0LVV/EvpFSXrlECbmyUmg2TU+Lyj6zS+clDAyl0qU3fLtrISpBV497UvjZ/aiKJS/EQC4WFjvK06fk=
  - secure: ygBujjmJQ2wIFtYnGxO7cZMyGWpGsyN7GV7h0ge6Vagq0uPhSUdmBfi8SmTAgiEYd88Ww2Wf6qiclten0qfaRhDUes3PY/OrkodyQE5HTX+JFk0lylSp0MAIJejeeWffmBX6suyHPkUE9Hwc8ZURaKUhUElfZ9B3ta8obYQFvEE0ZAgcYUVP1fepz1oZNyi5izzCMAir/n2HiILqEO0K4mlHemlMvWJWu3Hb5lNPbA5msn1/KaSmsAcTQktXk81nHqjHlXCqNlE3yZ+lXvZsc5BxJcuITXTU0Oq0awRPZHDvTeVyTmJT8GgmctbKOeIyqoSeZD4FkthZxbzlR5xp4WAkunc1LvWtaV86tPRmVVxIVfwrpha9wyZcF07Y4wbcLGaBmAoCKCHxsPUOkRJeYSzZ5yTQOi8qHfnn6l0nbMd4MzwphxvqyPoX23AU2xIE+NwyhQaY7f+wszL/1lvNs90vU2ljwE6baIzcZ4J/TBKGq7zs0DC7gt8N15rSJ/10CH7K68rbruWator0xYllqnjzCtCwIDvisx9Rrj7fIXVFyz/Xv3HafRFU8QM8+ne4Hg85PAKvGD5nl1Nb//XkJcyWG4S+gKosqjlNrBPjucpIm63lIdsD3fulR0z6PfPhodqBSyX4wf45cm/fa/3SZ1eFoCj1donYZ/+zPOqXol0=
