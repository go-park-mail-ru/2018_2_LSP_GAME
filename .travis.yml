language: go
go:
- 1.11
before_script:
- sudo apt-get install -qq sshpass
script: 
after_success:
- sshpass -p $SSH_PASS ssh -o StrictHostKeyChecking=no $SSH_USER@$SSH_HOST rm -r ~/server/game/*
- sshpass -p $SSH_PASS scp -rp -o stricthostkeychecking=no * $SSH_USER@$SSH_HOST:~/server/game
- sshpass -p $SSH_PASS ssh -o StrictHostKeyChecking=no $SSH_USER@$SSH_HOST docker
  build -t game-server ~/server/game 
- sshpass -p $SSH_PASS ssh -o StrictHostKeyChecking=no $SSH_USER@$SSH_HOST docker stop game 
- sshpass -p $SSH_PASS ssh -o StrictHostKeyChecking=no $SSH_USER@$SSH_HOST docker run -e "DB_HOST=postgres"
  -e "DB_USER=$DB_USER" -e "DB_PASS=$DB_PASS" -e "DB_DB=$DB_DB" -d --link postgres:postgres
  --publish 4040:8080 --name game --rm --link auth-grpc:auth-grpc --link user-grpc:user-grpc
  game-server
env:
  global:
  - secure: NTangIPMEWBXABirhL3rPTsMkgjqr5bNawMtk7ySqBu9Cphp6uX+jZ7SlSg2FLc2wky/EY03ZyhbbBIlhChwZPnh4tSjAdIWFZHtgeDjGSDSeT/onSxN5xcCCJtmXHRAkbrUSMSHRXwNn1dfIahOeTrkesTsWWOUMGrdKaRETkZ574c5eofoktwrQhoq+GRH9n3nxlLeavG9mosTbwAdFxh6xsXEm9PfmTYrYl5jzDGljwvmL49MVaWFen9MDMson6Fm1GDZjhlCB//+WJNyGT9HagwgWtF/jLZUpvjmrYW+Vk9OHx865La9iKXRZRZctiwte+e1J3g68C9S7/2CYhqs+9YKUE5vv6tG0WOw4phE5fKdiipSQU8vfH/cel1ghv8tQ5mWaGM+YXIsaTtcjMLLHS9XFAjG2/vAmmENk8YGVyNxdJ4+Iez3f0BgVpr35KTbKGl/+qo/aKZIfaSOZd2ThWqKpRMZ7Ld+SbqbfZmzJE1WE7NS8GF5xKjZPi4u6L0EcMvNFHTUyqS8kFVpE2rQXVHdcydxxn69TLulo2/SchzuxZQLsIyo4qLRFZh7giJo+3Dd77cBYd9LV61NkyMEuv9mW/iUhBja06uBu3CElyCHdfWfXJDCnF6Trmw80xJs5Mpol+NgSTHo0uFWkV1/aeXnLMrpH6NIWSC7jQI=
  - secure: Ts5ysYwS/o1nCpK5B5bilsZMYAwuCtvmO7JpbvV9xzChBs2xGU+0PaXc188r1QT2WxACnKf0x4KWM1GX6SLa8BTyKLz1+2+to+raaFGdRzFCzawFAMm+P9HWJdRDrerMp52tQg8KjI44aCJKMJAwU5518dk+Zhp1W+/I2SstXNNFss0Hw9EOz9SanjM8obHN9yEsrMZmeABrTW7ElltDdPHtjPtPcx1gb5r+P8IvBgi4UjRhOjDUB1cCTkEL5GJ9BwmHlnFzoXS8zq+TzlHa6tiGrBP70QAPAl3aGpDE78w78p7nKvw7m9OEN5CelNzPS6IMjLdRGmlOMOXlAUKP2xv2Z/hMiJU0m2upk+DJOEinDJZJW+oepndEW1xBOxeCO0i1/OJbJLpq5Jj/M5fhho8zHX+4rFrPVvi45y/LpG8S68koxsZTtStxPYk9o6bIt8607g2Dgc3sCIZoITIEjWB3F8aPoizhBtoGsydakfnV6wkhJfyq8XP7XExJUCcOChydKPczN7e4zkiv917d+0k6qnI0Cb96Lf2phCLYJPIAZRhstiyOLPWOD7oyNV39toQOYuqQh14JacdIr/KHQuCBejvPa+akpYM5KdOWQSjbv6kqzP+FztlRWQLjqHO2w7mBB1TPtmdQEwY5kHf0pdTBvZs7IKzgDPA2xiXVv3k=
  - secure: BD1lxceXcxRFCPJMBdS9JN42QnVx7yE+pa01bE2SP9zNfCIe+AHKm44vGVNp5RATJXSsIRGOUsSd0GA9lmH77dINY2iZH5wIfOSBKpLhOWntCMLGQZ/obQ1KlvHKejbuTKW2ys/fVmukQlbQFhT2X7bqJaPdUjtlYwwWIMLZt+P9C4l1PI9wkQAl3qV2ksm+psUcibwO3c158iKyTElQpVLv5CORQ02KgRfcoQ/cyRXln6ibZmCXEpd7cvA19+cIJvUHLSn8vurvhdfTGvC2/IWjK4F82KPfcfiHAz3kBLA9Erz3YPoCedHQz/+vmVvPDqEYFydbTf5IephSQQtIMr3HV3RetT2w6QO0g6b199SCBtuNXjU9AhBwoKke/1t/FAIkyW9sOZLpjnVj/40kiwBtmqUinJNzUGfy0dVtrzdGE6rXGXBIgTWkB6Uue83c/MA0B+1DYDtdniv46NPm1h/gWADz6caBpTXfHgbXDsxFPYopB/U3JUbxMzphVB0P6ZLTTWz56bkOzaWlzJulkEsClfQQeT9aS84tzb09rjlz0JbNPgfI8Rtgj2/xgm7nrYWstkmTQ3gM+Qpz5wa1Lur5n/tp2P/ty2EghW4xXhiCv5yCbiicfPLKlpujIcx4uG18g+P3OuPQP+e+vK88Jc9L2+/0IdB4zGqBnvDwmk4=
