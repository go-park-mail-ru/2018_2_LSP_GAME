language: go
sudo: false
matrix:
  include:
  - go: 1.x
before_install:
- go get github.com/mitchellh/gox
- curl -L https://git.io/vp6lP -o install.sh && sh install.sh -b $GOPATH/bin
- sudo apt-get install -qq sshpass
install:
- 
script:
- go get -t -v ./...
- gometalinter $(go list ./... | grep -v /vendor/)
- go test -v -race ./...
- CGO_ENABLED=0 gox -os="linux" -arch="amd64" -output="app.{{.OS}}.{{.Arch}}" -ldflags
  "-X main.Rev=`git rev-parse --short HEAD`" -verbose ./...
after_success:
- sshpass -p $SSH_PASS scp -rp -o stricthostkeychecking=no app.linux.amd64 Dockerfile
  $SSH_USER@$SSH_HOST:~/server/game
- sshpass -p $SSH_PASS ssh -o StrictHostKeyChecking=no $SSH_USER@$SSH_HOST docker
  build -t game-server ~/server/game
- sshpass -p $SSH_PASS ssh -o StrictHostKeyChecking=no $SSH_USER@$SSH_HOST docker
  stop game
- sshpass -p $SSH_PASS ssh -o StrictHostKeyChecking=no $SSH_USER@$SSH_HOST docker
  run -e "DB_HOST=postgres" -e "DB_USER=$DB_USER" -e "DB_PASS=$DB_PASS" -e "DB_DB=$DB_DB"
  -d --link postgres:postgres --publish 4040:8080 --name game --rm --link auth-grpc:auth-grpc
  --link user-grpc:user-grpc game-server
env:
  global:
  - secure: NTangIPMEWBXABirhL3rPTsMkgjqr5bNawMtk7ySqBu9Cphp6uX+jZ7SlSg2FLc2wky/EY03ZyhbbBIlhChwZPnh4tSjAdIWFZHtgeDjGSDSeT/onSxN5xcCCJtmXHRAkbrUSMSHRXwNn1dfIahOeTrkesTsWWOUMGrdKaRETkZ574c5eofoktwrQhoq+GRH9n3nxlLeavG9mosTbwAdFxh6xsXEm9PfmTYrYl5jzDGljwvmL49MVaWFen9MDMson6Fm1GDZjhlCB//+WJNyGT9HagwgWtF/jLZUpvjmrYW+Vk9OHx865La9iKXRZRZctiwte+e1J3g68C9S7/2CYhqs+9YKUE5vv6tG0WOw4phE5fKdiipSQU8vfH/cel1ghv8tQ5mWaGM+YXIsaTtcjMLLHS9XFAjG2/vAmmENk8YGVyNxdJ4+Iez3f0BgVpr35KTbKGl/+qo/aKZIfaSOZd2ThWqKpRMZ7Ld+SbqbfZmzJE1WE7NS8GF5xKjZPi4u6L0EcMvNFHTUyqS8kFVpE2rQXVHdcydxxn69TLulo2/SchzuxZQLsIyo4qLRFZh7giJo+3Dd77cBYd9LV61NkyMEuv9mW/iUhBja06uBu3CElyCHdfWfXJDCnF6Trmw80xJs5Mpol+NgSTHo0uFWkV1/aeXnLMrpH6NIWSC7jQI=
  - secure: Ts5ysYwS/o1nCpK5B5bilsZMYAwuCtvmO7JpbvV9xzChBs2xGU+0PaXc188r1QT2WxACnKf0x4KWM1GX6SLa8BTyKLz1+2+to+raaFGdRzFCzawFAMm+P9HWJdRDrerMp52tQg8KjI44aCJKMJAwU5518dk+Zhp1W+/I2SstXNNFss0Hw9EOz9SanjM8obHN9yEsrMZmeABrTW7ElltDdPHtjPtPcx1gb5r+P8IvBgi4UjRhOjDUB1cCTkEL5GJ9BwmHlnFzoXS8zq+TzlHa6tiGrBP70QAPAl3aGpDE78w78p7nKvw7m9OEN5CelNzPS6IMjLdRGmlOMOXlAUKP2xv2Z/hMiJU0m2upk+DJOEinDJZJW+oepndEW1xBOxeCO0i1/OJbJLpq5Jj/M5fhho8zHX+4rFrPVvi45y/LpG8S68koxsZTtStxPYk9o6bIt8607g2Dgc3sCIZoITIEjWB3F8aPoizhBtoGsydakfnV6wkhJfyq8XP7XExJUCcOChydKPczN7e4zkiv917d+0k6qnI0Cb96Lf2phCLYJPIAZRhstiyOLPWOD7oyNV39toQOYuqQh14JacdIr/KHQuCBejvPa+akpYM5KdOWQSjbv6kqzP+FztlRWQLjqHO2w7mBB1TPtmdQEwY5kHf0pdTBvZs7IKzgDPA2xiXVv3k=
  - secure: BD1lxceXcxRFCPJMBdS9JN42QnVx7yE+pa01bE2SP9zNfCIe+AHKm44vGVNp5RATJXSsIRGOUsSd0GA9lmH77dINY2iZH5wIfOSBKpLhOWntCMLGQZ/obQ1KlvHKejbuTKW2ys/fVmukQlbQFhT2X7bqJaPdUjtlYwwWIMLZt+P9C4l1PI9wkQAl3qV2ksm+psUcibwO3c158iKyTElQpVLv5CORQ02KgRfcoQ/cyRXln6ibZmCXEpd7cvA19+cIJvUHLSn8vurvhdfTGvC2/IWjK4F82KPfcfiHAz3kBLA9Erz3YPoCedHQz/+vmVvPDqEYFydbTf5IephSQQtIMr3HV3RetT2w6QO0g6b199SCBtuNXjU9AhBwoKke/1t/FAIkyW9sOZLpjnVj/40kiwBtmqUinJNzUGfy0dVtrzdGE6rXGXBIgTWkB6Uue83c/MA0B+1DYDtdniv46NPm1h/gWADz6caBpTXfHgbXDsxFPYopB/U3JUbxMzphVB0P6ZLTTWz56bkOzaWlzJulkEsClfQQeT9aS84tzb09rjlz0JbNPgfI8Rtgj2/xgm7nrYWstkmTQ3gM+Qpz5wa1Lur5n/tp2P/ty2EghW4xXhiCv5yCbiicfPLKlpujIcx4uG18g+P3OuPQP+e+vK88Jc9L2+/0IdB4zGqBnvDwmk4=
  - secure: Erm1xpWKHvBlveFQgRPNhWAagJQElcQEisfZ47ii0oM6k7lnxc+/3CuulA8GvjnywxXA1Kbu71brMzpTlJWDSR7LRbyYv6V3WOEirJWm5bM2MTV+F+7O6W2hZxbbGNaGPFkKhsh1Ohentcwh6AZav90VXG4Lmjgpjk1chvOOWEXhiMelp3fMvQtA5W9bi13Ng5SeMa08nnmymTN2urp3T6we0Xdq17MLUNsOWNn8ESUBL6HDahKwikNMYyV24thno4Bbw3awtQBmEAKXtXr9vfh5Nf6A+y1lxdyctdQlxgJb5GVqQ4eaW9F+hPR5Gp/XJm1PDuXZmfv+IaOPcxBq5ssmKpcspgSJAO8MojZ+Ppjp78dFT5VTTewBNmIidGWJE/lndEOFXe3XHtJ8F5oTebZdqk5jH0CbHgqXJlMURcRZermM8bJAs+yJMHv6oywEj/LZYmYUN4RqF5Vk7CKcuOk7WxpbVLjlFBfOIMDzDXbdk0Rrlf2XTZdHmNhFAwhwMSZQWsQZxIVSQ/PlwvAaSwws1S8I1t1IE7eiSa4vRV16T/vG2tH/oiqBiXGLtq1mLreq8JkNhNMrKVOe8hmO6ej1dlfnSxlyrsLoDjq5RRZ9mYDWVVaq0VvTiYMknTlo3qq9XhhYlQS1FJ0vGIWu0HIuMMBAfd3a+wNx3Vt5RDU=
  - secure: QaK2bMmd51jnw9QCD5wZyO5nuQ1qThS4tOXVlhyG26H26yTCMdYAy2EnITgtIG0HWYdtVEWSY/p0/JLm1jAkYGCS5pByAVLWCVcTsuxls3rBhuirmX8XcSrZoa+EikDhqogcUu9OUt7dmDnRSZ0jvB/6oTVNndQ6x9exruJHoZE67bBTmD8G7eSVVNMdgQxLTXbHduJ4aF3pi5wTGt0wO8DRt1Dj3QU5AA7pPjfM+eWlYdyzUQRylLFpyZ/YuwXSsHJe942UDagAGHV2GWRPbCuLOTUAVv8fVBoc9z/qCVe8MEYrH3ncN/uzekvzNFpMvHTFT5UG63GCTG6EBJg9vbi5nBHt2pJLXDq5Z2k40LW9ibD3g3HrEZwDzSm3ZztE6WEfIV7r9boU3k/kJVF61/jnO62eXbP/4YXMLJQVXOGfkWkZv6BCoeZT+Kdx9RO7lqiK45TY62NKrElEy+Jm/zBwx0z1LPVGdOsoGcHgtfw0Hdy63mOjEPUeNlMK+4ma/dm733OrjC22RwEYP0HoOrwCtTzKE+yDJS8Im6NIEZ+SlRNu8/BcLYtmoLrWXNMUjYx4VtLUU1Gz2G9HFGs0TAjTDyVMuLLxbs4jjRTKWja9I/fhQurEElHntKt9vBjOm9cxZ4vRJSBdNRxrJMwgaxq6eNPBJJBrCdMuoMj6/K8=
  - secure: QFEB72fsT5Nu8x89nt5DtcDv2dkcmOVsfLJz+NlA2uSHwLhBBQwMcr4opCvwo+kbCK6dXmrRK92fnK11E4nebO2AJihVjwRj4FwvBBSxRL7FvQBq+ZvCYrL8T3qzv0DyK74eegl4CCN8zd4712md8k2FnciV/+UES7WGbh3y/bCXl/BFD6C+SWvQhNl3l5YD1Kvk+pnIFrVJU1RuwcbPlck67PlO0w8uxd8If2u0pfpbhpq/VgcAJHmRRUKiAvHjIvHO+ceiUCPXvSTHHMsdLqfrPfZ/dwE87nJdcfeB++2OSrf6erFNP2MPzFrCxg9Eqd/dCx4+C5/VK0TqHKlZv5kylRfokhM6ghe+1kUtF2VDHLw84K9wj/l2zVbrME3Sw8BYrq8hreBuSnx+QGJzz7fcIVdkTt05zQVNqtCM77qQKgdirtZPE/hke2yRqT/Ps+BtDQf3iS8BOxM2FVHBqoLRRqEshtCAXOf/6rKBFLph590SCoV8ePAw2oypI9yQVWPaChTSeEeua4AYOe+jCm52zRY4dArN1H0uf03VijMM7eCx7OfbQJpWTp2zBOoU/UNTNZ2xYcTs+5k8YVtBUdrOtbYm6/eMxT/EpHh/w+YuoVsOvXy5VwaSd2oXYUT4lo2BMjUJl3Y8EG8+mdzm1JNTAlRKuZNjiMkqnQOxskY=
deploy:
  provider: releases
  api_key:
    secure: Xy8D7TbSBLwBCyTsALhvzafR8Rcbh8xn4Hp/mQ48sPM0xb2ThKjo0yDhhPXD6GSKd2OUtfJZXnulMhaQiL6q1gJe9MJQ7KJ6LT35GSHXmp3VfzYSapZ3ca3I9l9awbvOaQaKEW4KsxIt4eMUhNRsBEQr1+Dbez4JdDpR4WkUZF8s6rhbiFr5Q8vUQl+VVJkEYzoqwXALyDHj7whKHcJBDLW40pPXyCR8o4D1Glwx4lAAqoyO1GQp6XhcbAEh2I3a56W27jq6RI9zsxH188Jj4srA6kUTHO1m9ABtqr4XqHD8MszDuHl8Vz57D6l+wv62v82q1Chkey3gHTlg3JOUPVkRE5sZJgb+zFaxf/nEKl5LOrShg1QYDflJwjIBjwiBeDBGkrq4Ucxc61PA3/v/DYCGuHOlGui9+5G986AHK6tYYrj/huZD0TNbIroTEp9s5y6MTqhQ02pnXmMvXqAx4hO7ORJ5VOb61TSqEGce6qCywEyRy9Qrfkl5TObuqAh3IPwmfzchjVwIKUEfGW3w6OeXJNjWS+Shhw7cQfANZSQ0Q9r74sAuUFaA0iToPBKFqJ/FBl3HTY3UEoRZnwyDgZgtX1gQOeGLtILVahwO7tkd1rpFHMIiKM7AsRtELuuEZf0n6b+/btRudxhSZu3sfz3TpFVz2Fsf9J4s++bAqgk=
  skip_cleanup: true
  file:
    - app.linux.amd64
  on:
    repo: go-park-mail-ru/2018_2_LSP_GAME
